using Microsoft.AspNetCore.Http;
using Microsoft.EntityFrameworkCore;
using Mono.TextTemplating;
using System.Net;
using TpCrApp.Dal;

namespace TpCrApp
{
    public class Program
    {
        public static void Main(string[] args)
        {
            //WebApplication.Builder ??????????
            /*??? ASP.NET Core ????????????? ?????????????? ??????? ????? ????? (configuration) ????? services ?? ???????????.*/
            var builder = WebApplication.CreateBuilder(args);

            // Add services to the container.

            //Dependency Injection (Services)
            /*??? MVC (Model-View-Controller) pattern ?????????????? ??????? services ?? Dependency Injection (DI) container ?? ????? ?????????.
            ????, Controller, View ????? Model components ??? ????????? ??? ?????.*/
            builder.Services.AddControllersWithViews();



            /*Entity Framework Core (EF Core) ?? ????????? SQL Server ????????? ?? ??????? ?????????? ? ???? ?????????????.
            TouristPlaceContext ??? DB Context ?? dependency injection ?????? ????? ?????????.
            tpcs ????? appsettings.json ???? ???? ???????? ???????? ?????????.  */
            builder.Services.AddDbContext<TouristPlaceContext>(options =>
            {
                options.UseSqlServer(builder.Configuration.GetConnectionString("tpcs"));
            });

            // App Initialization (?????????? ??????????)
            var app = builder.Build();

            // Configure the HTTP request pipeline. / HTTP Request Pipeline Configuration
            /* Development mode ??????? (Production ???? Staging ??) Error Handling Middleware ?? ?????????????.
            Error ???????????? Home/Error ?????? ?????????? ?????????.*/
            if (!app.Environment.IsDevelopment())
            {
                app.UseExceptionHandler("/Home/Error");
            }

            //Static Files Middleware
            //CSS, JavaScript, Images ???? Static Files ?? ????? ????????? ????????????.
            app.UseStaticFiles();

            //Routing Middleware
            //Routing Middleware ????????????? request handling ??? ?????? ??????????????.
            app.UseRouting();


            //Authorization Middleware
            //User authentication &authorization ???? ????????????.
            app.UseAuthorization();



            //Define Default Route (??? ?????????? ???????????)
            /* ??? ???????? ???? (Default Route) ?? ????? ?????????.
             ????, URL ?? ????? ????????? ?????? ?????????,
             Home Controller ?? Index Action Method ?? ??? ?????????.*/
            app.MapControllerRoute(
                name: "default",
                pattern: "{controller=Home}/{action=Index}/{id?}");

            //Run the Application
            //??? ASP.NET Core ????????????? ???????????????.
            
            app.Run();

        }
    }
}
